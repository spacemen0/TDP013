<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tweeeter</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .tweet-container {
            margin: auto;
        }

        @media (max-width: 576px) {
            .tweet-container {
                max-width: 100%;
            }
        }

        @media (min-width: 577px) and (max-width: 768px) {
            .tweet-container {
                max-width: 80%;
            }
        }

        @media (min-width: 769px) {
            .tweet-container {
                max-width: 60%;
            }
        }
    </style>
</head>

<body>

    <div class="container ">
        <div class="tweet-container">
            <h1 class="mt-4 text-center">Tweeeter</h1>
            <div class="mb-4 ">
                <div class="d-flex">
                    <textarea id="tweetInput" class="form-control me-2" rows="3"
                        placeholder="What's happening?"></textarea>
                    <button class="btn btn-primary" id="postButton">Post</button>
                </div>
                <span id="warningText" class="text-danger d-none">Meddelanden får innehålla högst 140 tecken!</span>
            </div>

            <div id="tweets">
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script>
        function setCookie(name, value, days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = "expires=" + date.toUTCString();
            document.cookie = name + "=" + encodeURIComponent(value) + ";" + expires + ";path=/";
        }


        function getCookie(name) {
            const cname = name + "=";
            const cookiesArray = document.cookie.split(';');
            console.log("cookie array: ", cookiesArray)
            for (let i = 0; i < cookiesArray.length; i++) {
                let cookie = cookiesArray[i].trim();
                if (cookie.indexOf(cname) == 0) {
                    return decodeURIComponent(cookie.substring(cname.length, cookie.length));
                }
            }
            return "";
        }

        function appendTweetToCookie(content, time) {
            const tweets = getCookie("tweets");
            const tweetsArray = tweets ? JSON.parse(tweets) : [];


            tweetsArray.push({ content: content, time: time });

            setCookie("tweets", JSON.stringify(tweetsArray), 7);
        }

        function generateTweet(content, time) {
            const tweetCard = document.createElement('div');
            tweetCard.className = 'card mb-3';

            tweetCard.innerHTML = `
                <div class="card-body">
                    <div class="d-flex  justify-content-between align-items-start">
                        <div class="text-break">
                            <h5 class="card-title">John Doe</h5>
                            <p class="card-text" >${content}</p>
                            <p class="card-text"><small class="text-muted">Posted at ${time}</small></p>
                        </div>
                        <div class="form-check align-self-center ms-2">
                            <input class="form-check-input" style="width:30px;height:30px" type="checkbox" id="readCheck">
                        </div>
                    </div>
                </div>
            `;

            tweetCard.querySelector('#readCheck').addEventListener('change', function () {
                if (this.checked) {
                    tweetCard.classList.add('bg-light');
                } else {
                    tweetCard.classList.remove('bg-light');
                }
            });

            return tweetCard;
        }

        function loadTweetsFromCookie() {
            const tweets = getCookie("tweets");
            if (tweets) {
                const tweetsArray = JSON.parse(tweets);
                tweetsArray.reverse().forEach(tweet => {
                    const tweetCard = generateTweet(tweet.content, tweet.time);
                    document.getElementById('tweets').appendChild(tweetCard);
                });
            }
        }

        window.onload = loadTweetsFromCookie

        document.getElementById('postButton').addEventListener('click', function () {
            let tweetInput = document.getElementById('tweetInput');
            let warningText = document.getElementById('warningText');
            const tweetValue = tweetInput.value

            if (tweetValue.trim().length == 0) {
                warningText.innerText = "Content length cannot be zero";
                warningText.classList.remove("d-none");
            } else if (tweetValue.length > 140) {
                warningText.innerText = "Content length exceeds 140 characters";
                warningText.classList.remove("d-none");
            } else {
                warningText.classList.add("d-none");
                const time = new Date().toLocaleString();
                const tweetCard = generateTweet(tweetValue, time);
                document.getElementById('tweets').insertBefore(tweetCard, document.getElementById('tweets').firstChild);
                tweetInput.value = '';
                appendTweetToCookie(tweetValue, time)
            }
        });
    </script>

</body>

</html>